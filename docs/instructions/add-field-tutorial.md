# Как добавить новое поле в виджет

1. **Определи поле в типах и дефолтах**
   - Расширь соответствующий интерфейс в `src/stores/widgetSettings/types.ts`, добавив новое свойство с нужным типом/ограничениями.
   - Обнови дефолты виджета (`layouts/<Widget>/defaults.ts` и глобальные `stores/widgetSettings/defaults.ts`), чтобы поле всегда существовало с предсказуемым значением.
   - Если значение попадает в серверную валидацию, обнови `stores/widgetSettings/schema.ts`, добавив проверки (например, `z.number().min(...).max(...)`) и пометки `optional`, если это поле необязательно.

2. **Добавь экшены и хук**
   - В `layouts/<Widget>/actions.ts` добавь `set<ИмяПоля>` в `create...Actions`, чтобы можно было обновлять состояние.
   - Зарегистрируй новый метод в `stores/widgetSettings/widgetActions/types.ts` и прокинь его через `createWidgetSlice`.
   - Обнови хук в `layouts/<Widget>/hooks.ts`, чтобы он возвращал новый сеттер вместе с остальными настройками.

3. **Покажи поле в UI настроек**
   - В нужной секции настроек (`layouts/WidgetSettings/...`) добавь UI-элемент (`NumberField`, `Input`, `ColorAccessory` и т.д.).
   - Подключи хук и передавай текущее значение, используя `useWidgetStaticDefaults`, чтобы подставить дефолты, пока настройки ещё не инициализированы.
   - Установи `min/max`, placeholder, описание и валидацию по необходимости.

4. **Передай значение в рендер виджета**
   - Расширь пропсы компонента виджета (`layouts/<Widget>/<Widget>.tsx`) и зажми значение в нужных пределах (например, `Math.max(0, Math.min(20, field ?? default))`).
   - Пропиши передачу поля из экранов (`DesktopScreen`, `MobileScreen` и т.п.): `field={settings?.field}`.

5. **Проверка**
   - Убедись, что новое поле есть в дефолтах, схеме и действиях, чтобы состояние было согласованным.
   - Запусти при необходимости линтер/сборку и визуально проверь работу в настройках и предпросмотре.

